<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<script src="../../bower_components/momentjs/moment.js"></script>
<script src="../../bower_components/momentjs/locale/nl.js"></script>
<link href='https://fonts.googleapis.com/css?family=Lato:100,200,300,600,900' rel='stylesheet' type='text/css'>

<dom-module id="my-list">
  <style>
    :host {
      display: block;
      font-family: "Lato", sans-serif !important;
      text-transform: uppercase;
      letter-spacing: normal;
    }

  .thumb {
    width: 75px;
    height: 75px;
    overflow: hidden;
    border-radius: 50%;
  }

  .content {
    padding: 0px 0px 10px 20px;
    width: 100%;
  }

  h1 {
    font-size: 18px;
    line-height: 10px;

  }

  h3 {
    font-size: 11px;
    line-height: 6px;
    color: black;
    margin-top: -5px;
    opacity: 0.6;
  }

  h2 {
    font-size: 38px;
    color: white;
    margin-bottom: -10px;
  }

  .playitem {
  display: block;
  padding: 2% 4% 2% 4%;
  border-bottom: 1px solid #db4f4f;
  max-width: 600px;
  width: 100%;
  }


.active {
  background-color: white !important;
}



.active h2 {
  color: black;
  display: block;
  font-weight: 600;
  white-space: normal;
  line-height: 90%;
  margin-bottom: -10px;

    }

.playitem .active .plays {
/*  color: #A63B3C;
*/
  color: black;
  opacity: 0.4;

  }



.active h1 {
  color: #e55253;
  display: block;
  font-weight: 600;
  white-space: normal;
  line-height: 90%;
  }

  .active h3 {
  color: #e55253;
  font-size: 11px;
  line-height: 6px;
  }



.black {
  color: black;
}

.red {
  color: #e55253;
}


  h2 {
  color: white;
  white-space: normal;
  display: block;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 90%;
  font-weight: 400;
  width: 85%;
  font-size: 1em;
}


h1 {
  color: black;
  display: block;
  font-weight: 400;
  line-height: 90%;
  width: 85%;
}

  </style>
  <template>

    <firebase-collection
      id="fb" 
      order-by-child="unixtimestamp"
      data="{{items}}"
      on-firebase-value="dataChanged"></firebase-collection>
      
      <iron-selector selected="{{currenttrack}}" on-iron-select="chooseclip" id="menuke" selected-class="active" attr-for-selected="id" class="vertical layout center">
        
      <template is="dom-repeat" items="{{myplaylist}}">
            
            <div class="horizontal layout playitem " id="{{item.youtube}}">
              <div class="vertical layout center center-justified">
                <img src="{{item.image}}" class="thumb">
              </div>
              <div class="content horizontal layout flex">
                <div class="flex">
                  <h2>{{item.songtitle}}</h2>
                  <h1>{{item.artist}}</h1>
                  <h3>{{item.playtime}}</h3>
                </div>
              </div>
            </div>
        
      </template>

      </iron-selector>

      <iron-signals on-iron-signal-changechannel="changechannel"></iron-signals>
      <iron-signals on-iron-signal-clipstatechanged="clipstatechanged"></iron-signals>

  </template>
</dom-module>
<script>
  (function () {
    Polymer({
      is: 'my-list',
      properties: {
        items: {
          type: Array,
          notify: true,
        },

        radiostation: {
          type: Number,
          observer: 'setRadiostation'
        },

        currenttrack: {
            value: false,
            notify: true          
        },

        myplaylist: {
          observer: 'checktrack'
        }
    
      },
      ready: function() {
        //this.fire('changeYoutubeclip', {'msg': '9Sc-ir2UwGU'});

      },

      checktrack: function(){

           this.toptrack = this.myplaylist[0].youtube;

          console.log(this.toptrack);
          this.$.menuke.select(this.toptrack);
       
      },
   

    formatTime: function(){
      this.playTime = moment(this.timePlayed).format('dddd D MMMM, HH:mm');
    },

      clipstatechanged: function(e, detail){
        //console.log('clip changed state: ', e, detail);
        if(detail==0){
          //console.log('liedje is gedaan, speel volgende');
          //this.fire('iron-signal', {name: 'nexttrack'});
          this.$.menuke.selectPrevious();
        }
      },

      changechannel: function(e, detail, sender){
        this.radiostation = detail;
        //console.log('change channel to ', detail);
      },

      changeclip: function(e){
        //console.log('change clip ',e.detail.msg);
        //this.fire('changeclip', {'msg': e.detail.msg});
      },

      chooseclip: function(e, detail, sender){
        //console.log('clip change: ', detail.item.id);
        //this.fire('changeclip', {'msg': detail.item.attributes[0].value });
        this.fire('iron-signal', {name: 'changeyoutubeclip', data: detail.item.id});
      },

      setRadiostation: function(){
        var now = new Date();
        var fullDaysSinceEpoch = Math.floor(now / 8.64e7);
        this.$.fb.location = 'https://popping-heat-1762.firebaseio.com/radioplus/playlists/'+this.radiostation+'/'+fullDaysSinceEpoch;
      },

      dataChanged: function(){
        //this.myplaylist = [];
        var myplaylist = [];
        for (var i = this.items.length - 1; i >= 0; i--) {
          //console.log(this.items[i]);
          if(!this.items[i].image){
            this.image = "images/imagenotfound.png";
          } else {
            this.image = this.items[i].image;
          };


          this.playTime = moment(this.items[i].timestamp).format('dddd D MMMM, HH:mm');

          myplaylist.push({  'songtitle': this.items[i].title,
                            'artist': this.items[i].artist,
                            'image': this.image,
                            'unixtimestamp': this.items[i].unixtimestamp,
                            'spotify': this.items[i].spotify, 
                            'firebasekey': this.items[i].__firebaseKey__,
                            'youtube': this.items[i].videoid,
                            'playtime': this.playTime
          });
        };
        //console.log('data changed');
        //console.log(myplaylist);
        this.myplaylist = myplaylist;
        
      }
    });
  })();
</script>
